---
title: "Final Project"
author: "Kaijie(KJ) WU, Carey Cui, XiaoTian Tang"
date: today
date-format: long
format: 
    html:
        echo: false      
        code: false      
        toc: true        
        output: true     
engine: jupyter
---

```{python}
%reset -f
import pandas as pd
import altair as alt
import statsmodels.api as sm
alt.renderers.enable('html')
import os

#import data
age_df = pd.read_csv('/Users/Kaijie/Desktop/Python II Final Project/Education/CPS_Demographic_Turnout_Rates_v1.0.csv')

age_group = age_df[['YEAR', 'CPS_ADJ_AGE1829_RATE', 'CPS_ADJ_AGE3044_RATE', 'CPS_ADJ_AGE4559_RATE', 'CPS_ADJ_AGE60_RATE']].copy()
age_group_names = {
    'CPS_ADJ_AGE1829_RATE': 'Age 18-29',
    'CPS_ADJ_AGE3044_RATE': 'Age 30-44',
    'CPS_ADJ_AGE4559_RATE': 'Age 45-59',
    'CPS_ADJ_AGE60_RATE': 'Age 60+'
}
age_group.rename(columns=age_group_names, inplace=True)

#only focus on presidential election
presidential_group = age_group[age_group['YEAR'] >= 1988]
presidential_group = age_group[age_group['YEAR'] % 4 == 0]

```

This year, 2024, is an election year. We have witnessed a lot of big news: the withdrawal of Joe Biden and Donald Trump's return to the White House. Some states indicate that the turnout rate is lower than the election yeat in 2020. Alabama even declares the lowest turnout rate in over 30 years. These events make us interested in turnout rate. Our research questions are What factors affect turnout rate and how these fatocrs affect turnout rates.

The first factor we think is state.
(Xiaotian)

The second factor we are interested in is age. We want to analyze how age affects turnout rates. To start, we observe that the data is distributed over the year, with each year having a different turnout rate for various age groups. Based on these observations, we use Altair to plot the first diagram. We set the election year as the x-axis and the turnout rate as the y-axis, using different colors for each age group. Here is what the first diagram looks like:
```{python}
#organzing the data
long_format = pd.melt(presidential_group, id_vars='YEAR',
                      value_vars=['Age 18-29', 'Age 30-44', 'Age 45-59', 'Age 60+'],
                      var_name='Age Group', value_name='Turnout Rate')

#create the line chart
chart_age = alt.Chart(long_format).mark_line(point=True).encode(
    x=alt.X('YEAR:O', title='Election Year',axis=alt.Axis(labelAngle=0)),
    y=alt.Y('Turnout Rate:Q', title='Turnout Rate', axis=alt.Axis(format='%', titleAnchor='middle')),
    color=alt.Color('Age Group:N', legend=alt.Legend(title="Age Group")),
    tooltip=[alt.Tooltip('YEAR:O', title='Year'),
             alt.Tooltip('Turnout Rate:Q', title='Turnout Rate', format='.2%'),
             alt.Tooltip('Age Group:N', title='Age Group')]
).properties(
    title="Voter Turnout by Age Group in Presidential Elections (1988+)",
    width=400,
    height=400
)

#display the chart
chart_age
```

Based on the first diagram, we can see that the age group 18-29 has a relatively lower turnout rate than other age groups over the election years. Additionally, the gap in turnout rates decreases as people age. However, the diagram only provides a general picture of how the turnout rate changes over the election years for each age group. Because the gaps in turnout rates are not an intuitive way to show how age affects political participation, we decided to average the turnout rates over the election years and calculate the change in turnout rate between each age group. We can then use these results to plot the diminishing marginal rate of age (the change in turnout rate between each age group). We use Altair to create the diagram, setting age as the x-axis and the change in turnout rate as the y-axis. Here are the following plots:
```{python}
#calculate the differences in mean
mean_turnout = presidential_group[['Age 18-29', 'Age 30-44', 'Age 45-59', 'Age 60+']].mean().reset_index()
mean_turnout.columns = ['Age Group', 'Average Turnout Rate']
mean_turnout['Next Turnout Rate'] = mean_turnout['Average Turnout Rate'].shift(-1)
mean_turnout['Difference'] = mean_turnout['Next Turnout Rate'] - mean_turnout['Average Turnout Rate']  
mean_turnout['Comparison'] = mean_turnout['Age Group'] + " vs " + mean_turnout['Age Group'].shift(-1)
comparison_data = mean_turnout[:-1].copy()


#create chart for Diminishing Marginal Rate of Age
base_chart_marginal = alt.Chart(mean_turnout).mark_line(point=True).encode(
    x=alt.X('Age Group:N', title='Age Group', sort=['Age 18-29', 'Age 30-44', 'Age 45-59', 'Age 60+'], axis=alt.Axis(labelAngle=0)),
    y=alt.Y('Average Turnout Rate:Q', 
            title='Average Turnout Rate', 
            axis=alt.Axis(format='%'),
            scale=alt.Scale(domain=[0.415, 0.7])  
           ),
    tooltip=[
        alt.Tooltip('Age Group:N', title='Age Group'),
        alt.Tooltip('Average Turnout Rate:Q', title='Turnout Rate', format='.2%'),
        alt.Tooltip('Difference:Q', title='Difference to Next', format='.2%')
    ]
).properties(
    title="Diminishing Marginal Rate of Age",
    width=400,
    height=400
)

base_chart_marginal
```

```{python}
#create bar chart to show the differences in age group
bar_chart = alt.Chart(comparison_data).mark_bar().encode(
    x=alt.X('Comparison:N', title='Age Group Comparison', sort=None, axis=alt.Axis(labelAngle=0)),
    y=alt.Y('Difference:Q', title='Change in Turnout Rate', axis=alt.Axis(format='%')),
    tooltip=[
        alt.Tooltip('Comparison:N', title='Comparison'),
        alt.Tooltip('Difference:Q', title='Change in Turnout Rate', format='.2%')
    ]
).properties(
    title="Change in Voter Turnout Rate Between Age Groups",
    width=400,
    height=300
)
bar_chart
```

Based on the diagrams above, we can intuitively see the change in turnout rate between different age groups. As people getting older, the turnout rate tends to increase, and the differences in turnout rates diminish. Thus, we can confirm that age does have an impact on turnout rates.

The third factor we are interested in is education. In this part, we are looking for the connection between the education level and the turnout rates. As a result, we have four education levels: post-college graduate, some or college graduate, high school graduate, and no high school. After that, we collect the data from the Election Lab at the University of Florida. The data are reweighted by the author using a procedure proposed by Hur and Achen. We filter the data and have a new data set of turnout rates by different eduation level. Finally, we draw the line chart with four different colors to present the change in turnout rates by education level from 1988 to 2020.

```{python}
# Load the dataset
data = pd.read_csv('/Users/Kaijie/Desktop/Python II Final Project/Education/CPS_Demographic_Turnout_Rates_v1.0.csv')

# Specify the election years of interest
specified_years = [1988, 1992, 1996, 2000, 2004, 2008, 2012, 2016, 2020]

# Convert 'YEAR' to integer for proper sorting and plotting in Altair
data['YEAR'] = data['YEAR'].astype(int)

# Filter the data for the specified years and melt it for Altair plotting
alt_data = data[data['YEAR'].isin(specified_years)][['YEAR', 'CPS_ADJ_NOHS_RATE', 'CPS_ADJ_HS_RATE', 'CPS_ADJ_COLLEGE_RATE', 'CPS_ADJ_POST_RATE']]
alt_data = alt_data.melt('YEAR', var_name='Education Level', value_name='Turnout Rate')

# Map original column names to more descriptive labels
education_label_map = {
    'CPS_ADJ_NOHS_RATE': 'No High School',
    'CPS_ADJ_HS_RATE': 'High School Graduate',
    'CPS_ADJ_COLLEGE_RATE': 'Some or College Graduate',
    'CPS_ADJ_POST_RATE': 'Post-College School'
}
alt_data['Education Level'] = alt_data['Education Level'].map(education_label_map)

# Create the Altair chart
chart = alt.Chart(alt_data).mark_line(point=True).encode(
    x=alt.X('YEAR:N', axis=alt.Axis(title='Year', labelAngle=0)),  # Treat year as nominal for custom sorting
    y=alt.Y('Turnout Rate:Q', axis=alt.Axis(title='Adjusted Turnout Rate')),
    color=alt.Color('Education Level:N', legend=alt.Legend(title="Education Level")),
    tooltip=['YEAR', 'Education Level', 'Turnout Rate']
).properties(
    title='Turnout Rate by Education Level for Specified U.S. Election Years',
    width=600,
    height=400
).configure_axis(
    grid=True
)

chart.display()

```

From the above chart, we can see that the citizens with higher education level have higher turnout rates. The citizens with post-college school degrees have the highest turnout rate, but the citizens without high school education have the lowest turnout rates. Additionally, the gaps of turnout rates between each education level are similar between 1988 and 2020 (around 15%).

To increase the turnout rates, there are three potential policy implications. The first one is to optimize the election policies between states. This one would help increase the turnout rates in the non-swing states. The second is to target the young voters. The turnout rates in young people are much lower than the old people. Motivating young people to vote can dramatically increase turnout rates. The third one is to focus on the low-education groups. The people with low education level have low turnout rates. Sensitizing them to the importance of voting might be one way to increase turnout rates.

However, there are some limitations in the project. The first one is the omitted variable bias. There would be other variables correlated with turnout rates and the above three factors, so biased outcome. Besides, Due to the data limitation, age, education cannot be classified as states level.Therefore, interaction effects between states and demographic variables could not be explored.

In order to study this topic in greater depth, the future direction should concentrate on exploring additional variables, using advanced modeling techniques, and expanding outcome measures about political participation. Additional variables would help to address the problem of biased outcome. The advanced modeling techniques, such as nonlinear regression, would show the correlation between these fators and turnout rates. Finally, turnout rates cannot be 100 percent to represent political participation, so the consideration of other measurements is also significant.

In conclusion, we believe that states, age, and education level are three factors affect the turnout rates. Although there are some limitations in the project, our project deserves a further research and more concentration.













